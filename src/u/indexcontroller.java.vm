##设置回调
$!callback.setFileName($tool.append("IndexController.java"))
$!callback.setSavePath($tool.append($tableInfo.savePath, "/controller"))

#if($tableInfo.savePackageName)package $!{tableInfo.savePackageName}.#{end}controller;

import $!{tableInfo.savePackageName}.config.exception.AllExceptionHandle;
import $!{tableInfo.savePackageName}.service.IndexService;
import $!{tableInfo.savePackageName}.util.R;
import com.fasterxml.jackson.core.JsonProcessingException;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.io.UrlResource;
import org.springframework.http.ContentDisposition;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import javax.validation.constraints.NotNull;
import java.nio.charset.StandardCharsets;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Properties;

import static #if($tableInfo.savePackageName)$!{tableInfo.savePackageName}.#{end}config.constant.Constant.SAVE_FOLDER;

/**
 * 主页控制层
 *
 * @author $!author
 * @since $!time.currTime()
 */
@Slf4j
@RestController
@RequestMapping("api/index")
@Api(tags = "主页")
public class IndexController {
    /**
     * 服务对象
     */
    @Resource
    private IndexService indexService;
    @Resource
    private AllExceptionHandle allExceptionHandle;

    /**
     * 监控内存
     *
     * @return 运行环境信息
     * @throws JsonProcessingException json转化异常
     */
    @ApiOperation("监控内存")
    @GetMapping("monitor")
    public ResponseEntity<R> monitor() throws JsonProcessingException {
        return R.deal(this.indexService.monitor());
    }

    /**
     * 上传文件
     *
     * @param file 上传的文件
     * @return 上传结果
     */
    @ApiOperation("上传文件")
    @PostMapping("upload")
    public ResponseEntity<R> upload(@ApiParam(value = "文件") @RequestParam("file") @NotNull(message = "文件不允许为空") MultipartFile file) {
        return R.deal(this.indexService.upload(file));
    }

    /**
     * 下载文件
     *
     * @param id 文件唯一ID
     * @return 文件
     */
    @ApiOperation("下载文件")
    @GetMapping("download/{id}")
    public ResponseEntity<org.springframework.core.io.Resource> downloadFile(@ApiParam(value = "文件唯一ID") @NotNull(message = "文件唯一ID不允许为空") @PathVariable("id") String id) {
        return this.indexService.download(id);
    }
}